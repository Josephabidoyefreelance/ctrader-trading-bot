<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Live EMA + Supertrend Renko Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #111;
        color: white;
        text-align: center;
        margin: 0;
        padding: 20px;
      }
      h1 {
        color: #00ff99;
      }
      #chart {
        width: 90%;
        max-width: 900px;
        height: 500px;
        margin: 20px auto;
        background: #222;
        border-radius: 10px;
        padding: 10px;
      }
      #signalBox {
        font-size: 1.5rem;
        margin-top: 20px;
      }
      .buy {
        color: #00ff99;
      }
      .sell {
        color: #ff4444;
      }
    </style>
  </head>
  <body>
    <h1>ðŸ“Š Live Renko + EMA + Supertrend</h1>
    <canvas id="chart"></canvas>
    <div id="signalBox">Waiting for live data...</div>

    <script>
      const ctx = document.getElementById("chart").getContext("2d");

      const chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: [],
          datasets: [
            {
              label: "Close Price",
              data: [],
              borderColor: "#00bfff",
              borderWidth: 2,
              tension: 0.2,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: { legend: { labels: { color: "white" } } },
          scales: {
            x: { ticks: { color: "white" } },
            y: { ticks: { color: "white" } },
          },
        },
      });

      const signalBox = document.getElementById("signalBox");

      // Connect to WebSocket
      const ws = new WebSocket("ws://127.0.0.1:8000/ws");

      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        const { time, close, signal } = data;

        chart.data.labels.push(time);
        chart.data.datasets[0].data.push(close);

        if (chart.data.labels.length > 50) {
          chart.data.labels.shift();
          chart.data.datasets[0].data.shift();
        }

        chart.update();

        if (signal === "BUY") {
          signalBox.innerHTML = "ðŸŸ¢ BUY SIGNAL";
          signalBox.className = "buy";
        } else if (signal === "SELL") {
          signalBox.innerHTML = "ðŸ”´ SELL SIGNAL";
          signalBox.className = "sell";
        } else {
          signalBox.innerHTML = "ðŸŸ¡ HOLD";
          signalBox.className = "";
        }
      };

      ws.onopen = () => console.log("Connected to WebSocket âœ…");
      ws.onerror = (err) => console.error("WebSocket Error:", err);
    </script>
  </body>
</html>
